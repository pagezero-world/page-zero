---
export const prerender = false;
import BaseLayout from "../../../../layouts/BaseLayout.astro";
const { id } = Astro.params;
---
<BaseLayout title="DM • Adventurers">
  <section class="page-block">
    <h1>Adventurers</h1>
    <p>Manage who’s part of this adventure.</p>

    <div class="page-block">
      <ul id="advList" class="stack"></ul>
    </div>
  </section>

  <script type="module" define:vars={{ id }}>
    import { dbPromise } from "../../../../lib/firebase/client.js";
    import { collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const listEl = document.getElementById("advList");

    (async () => {
      listEl.innerHTML = "";
      try {
        const db = await dbPromise;
        // Example collection structure: memberships with {campaignId, userEmail, role}
        const q = query(collection(db, "memberships"), where("campaignId", "==", id));
        const snap = await getDocs(q);
        if (snap.empty) {
          const li = document.createElement("li");
          li.className = "box";
          li.textContent = "No adventurers yet. Use Invite Adventurers to add people.";
          listEl.appendChild(li);
        } else {
          snap.forEach(doc => {
            const d = doc.data();
            const li = document.createElement("li");
            li.className = "box";
            li.textContent = `${d?.userEmail || "unknown"} — ${d?.role || "adventurer"}`;
            listEl.appendChild(li);
          });
        }
      } catch (e) {
        console.warn("Load adventurers failed:", e);
      }
    })();
  </script>
</BaseLayout>
